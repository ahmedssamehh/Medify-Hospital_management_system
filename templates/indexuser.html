<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medify - User Dashboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- AOS CSS for animations -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../static/css/custom.css">
    <style>
        /* General theme enhancements */
        
         :root {
            /* Light mode (default) */
            --primary-color: #0078d7;
            --secondary-color: #4eb1f5;
            --accent-color: #5dc1a9;
            --light-bg: #f5f9fc;
            --text-color: #333333;
            --text-muted: #6c757d;
            --card-bg: #ffffff;
            --body-bg: #f8f9fa;
            --border-color: rgba(0, 0, 0, 0.1);
            --navbar-bg: linear-gradient(to right, #0078d7, #5dc1a9);
            --hero-overlay: rgba(255, 255, 255, 0.8);
            --hero-pattern: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23e0e7ff' fill-opacity='0.3'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            --pattern-opacity: 0.5;
            /* Specific elements */
            --dropdown-text: #333;
            --link-color: #0078d7;
            --nav-link-color: #ffffff;
            --form-label: #495057;
            --card-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            /* Status colors */
            --success-color: #28a745;
            --info-color: #17a2b8;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            /* Text effects */
            --text-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            --heading-glow: 0 0 10px rgba(0, 120, 215, 0.6);
            --section-text-color: #333333;
        }
        
        body {
            background-color: var(--body-bg);
            color: var(--text-color);
            font-family: 'Poppins', sans-serif;
            background: #f8f9fa;
        }
        /* Welcome heading styles */
        
        .display-4 {
            color: var(--section-text-color);
            text-shadow: var(--text-shadow);
        }
        
        .display-4 .text-primary {
            text-shadow: var(--heading-glow);
        }
        /* Navbar text */
        
        .navbar .nav-link {
            color: var(--nav-link-color) !important;
        }
        /* Section headings */
        
        .section-heading {
            position: relative;
            margin-bottom: 2rem;
            color: var(--section-text-color);
        }
        
        .section-heading::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 3px;
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
        }
        /* Notification dropdown styling */
        
        .notification-badge {
            position: absolute;
            top: 0;
            right: 0;
            font-size: 10px;
            padding: 2px 5px;
            background-color: #dc3545;
            color: white;
            border-radius: 50%;
            min-width: 18px;
            text-align: center;
        }
        
        .notifications-wrapper {
            max-height: 300px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) #f0f0f0;
        }
        
        .notifications-wrapper::-webkit-scrollbar {
            width: 6px;
        }
        
        .notifications-wrapper::-webkit-scrollbar-track {
            background: #f0f0f0;
            border-radius: 10px;
        }
        
        .notifications-wrapper::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
        }
        
        .dropdown-menu {
            padding: 0;
            overflow: hidden;
            border: none;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            background-color: var(--card-bg);
        }
        
        .dropdown-header {
            background-color: var(--primary-color);
            color: white;
            border-bottom: 1px solid var(--border-color);
            padding: 12px 15px;
        }
        
        .notification-item {
            padding: 12px 20px;
            border-bottom: 1px solid var(--border-color);
            transition: all 0.2s ease;
            background-color: var(--card-bg);
            color: var(--text-color);
        }
        
        .notification-item:hover {
            background-color: var(--light-bg);
        }
        
        .notification-item.unread {
            background-color: rgba(0, 120, 215, 0.05);
            border-left: 3px solid var(--primary-color);
        }
        
        .notification-icon {
            width: 38px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(0, 120, 215, 0.1);
            color: var(--primary-color);
        }
        
        .notification-item.unread .notification-icon {
            background-color: var(--primary-color);
            color: white;
        }
        
        .notification-title {
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 2px;
        }
        
        .notification-time {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .btn-mark-read {
            padding: 3px 8px;
            font-size: 11px;
            border-radius: 15px;
            background-color: rgba(0, 120, 215, 0.1);
            color: var(--primary-color);
            border: 1px solid rgba(0, 120, 215, 0.2);
        }
        
        .btn-mark-read:hover {
            background-color: var(--primary-color);
            color: white;
        }
        
        .dropdown-footer {
            background-color: var(--light-bg);
            border-top: 1px solid var(--border-color);
            padding: 10px;
        }
        
        .view-all-link {
            color: var(--primary-color);
            font-weight: 500;
            text-decoration: none;
        }
        
        .view-all-link:hover {
            color: var(--secondary-color);
            text-decoration: underline;
        }
        /* Doctor cards with hover effect */
        
        .hover-card {
            transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
            background-color: var(--card-bg);
        }
        
        .hover-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }
        
        .hover-card .card-img-top {
            transition: transform 0.6s ease;
        }
        /* Animation classes */
        
        .fade-in {
            animation: fadeIn 0.8s ease forwards;
        }
        
        .slide-up {
            animation: slideUp 0.8s ease forwards;
        }
        
        .pulse-slow {
            animation: pulseSlow 3s infinite;
        }
        
        .float {
            animation: float 5s ease-in-out infinite;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulseSlow {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }
        
        @keyframes float {
            0% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
            100% {
                transform: translateY(0px);
            }
        }
        /* Status colors */
        
        .bg-success-subtle {
            background-color: rgba(var(--success-color), 0.1) !important;
        }
        
        .bg-danger-subtle {
            background-color: rgba(var(--danger-color), 0.1) !important;
        }
        
        .bg-warning-subtle {
            background-color: rgba(var(--warning-color), 0.1) !important;
        }
        
        .bg-info-subtle {
            background-color: rgba(var(--info-color), 0.1) !important;
        }
        
        .bg-primary-subtle {
            background-color: rgba(var(--primary-color), 0.1) !important;
        }
        /* Hero section style */
        
        .hero-section {
            background: linear-gradient(135deg, var(--hero-overlay), var(--hero-overlay)), url('https://images.unsplash.com/photo-1505751172876-fa1923c5c528?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80');
            background-size: cover;
            background-position: center;
        }
        /* Card and section styles */
        
        .card {
            background-color: var(--card-bg);
            border-color: var(--border-color);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .navbar {
            background: var(--navbar-bg) !important;
        }
        
        section {
            position: relative;
            overflow: hidden;
        }
        
        section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: var(--hero-pattern);
            opacity: var(--pattern-opacity);
            z-index: -1;
        }
        
        .bg-pattern {
            display: none;
            /* Hide old pattern div */
        }
        
        /* Toast styling */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }
        
        .toast {
            min-width: 300px;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .toast.show {
            opacity: 1;
        }
        
        /* Add star rating styling */
        .star-rating {
            display: flex;
            flex-direction: row-reverse;
            justify-content: flex-end;
        }
        
        .star-rating input {
            display: none;
        }
        
        .star-rating label {
            cursor: pointer;
            font-size: 24px;
            color: #ddd;
            margin-right: 5px;
            transition: color 0.2s;
        }
        
        .star-rating label:hover,
        .star-rating label:hover ~ label,
        .star-rating input:checked ~ label {
            color: #ffc107;
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark shadow sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold fs-3" href="#">
                <i class="fas fa-heartbeat me-2 pulse"></i>Medify
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link active" href="#home"><i class="fas fa-home me-1"></i> Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('profile') }}"><i class="fas fa-user-circle me-1"></i> Profile</a></li>
                    <li class="nav-item"><a class="nav-link" href="#doctors"><i class="fas fa-user-md me-1"></i> Doctors</a></li>
                    <li class="nav-item"><a class="nav-link" href="#appointments"><i class="fas fa-calendar-check me-1"></i> Appointments</a></li>

                    <!-- Notifications Dropdown -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle position-relative" href="#" id="notificationsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" data-bs-auto-close="outside">
                            <i class="fas fa-bell me-1"></i> Notifications {% if notification_count and notification_count > 0 %}
                            <span class="notification-badge">{{ notification_count }}</span> {% endif %}
                        </a>
                        <div class="dropdown-menu dropdown-menu-lg-end dropdown-menu-end notification-dropdown" aria-labelledby="dropdownMenuButton1" style="width: 320px; max-width: 100vw;">
                            <div class="dropdown-header d-flex justify-content-between align-items-center py-3 px-3">
                                <h6 class="mb-0 fw-bold">Notifications <span class="badge bg-primary rounded-pill">{{ notification_count }}</span></h6>
                                <button class="btn btn-sm btn-outline-light" onclick="clearAllNotifications()">Mark all as read</button>
                            </div>
                            <div class="notifications-wrapper" style="max-height: 350px; overflow-y: auto;">
                                {% if notifications and notifications|length > 0 %} {% for notification in notifications %}
                                <div class="notification-item p-3 border-bottom unread" data-notification-id="{{ notification.id }}">
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="notification-icon bg-{{ notification.bg_class }}-subtle rounded-circle p-2 me-2">
                                            <i class="fas {{ notification.icon_class }} text-{{ notification.bg_class }}"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0 fw-semibold">{{ notification.title }}</h6>
                                            <small class="text-muted">{{ notification.time }}</small>
                                        </div>
                                        <button class="btn btn-sm btn-link text-primary ms-auto p-0 btn-mark-read">
                                                <i class="fas fa-check"></i>
                                            </button>
                                    </div>
                                    <p class="small mb-0 text-secondary">{{ notification.message }}</p>
                                </div>
                                {% endfor %} {% else %}
                                <div class="p-4 text-center">
                                    <i class="fas fa-bell-slash fa-2x text-muted mb-3"></i>
                                    <p class="mb-0 text-muted">No notifications</p>
                                </div>
                                {% endif %}
                            </div>
                            <div class="dropdown-footer text-center p-2 bg-light">
                                <a href="#" class="text-primary small fw-semibold text-decoration-none">View all notifications</a>
                            </div>
                        </div>
                    </li>

                    <li class="nav-item"><a class="nav-link" href="#suggestions"><i class="fas fa-comment-alt me-1"></i> Feedback</a></li>
                    <li class="nav-item"><a class="nav-link" href="/logout"><i class="fas fa-sign-out-alt me-1"></i> Logout</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Home Section with Medical Theme -->
    <section id="home" class="min-vh-100 d-flex align-items-center hero-section">
        <div class="container text-center">
            <div class="fade-in" data-aos="fade-up" data-aos-duration="1000">
                <h1 class="display-4 fw-bold mb-4">Welcome to <span class="text-primary">Medify</span></h1>
                <p class="lead mb-5 text-muted mx-auto" style="max-width: 700px;">
                    Your trusted healthcare companion. Manage your health, book appointments with specialists, and stay up-to-date with your medical needs - all in one place.
                </p>
                <div class="d-flex justify-content-center gap-3 mb-5">
                    <a href="#doctors" class="btn btn-primary btn-lg shadow-sm">
                        <i class="fas fa-user-md me-2"></i>Find a Doctor
                    </a>
                    <a href="#appointments" class="btn btn-outline-primary btn-lg shadow-sm">
                        <i class="fas fa-calendar-check me-2"></i>View Appointments
                    </a>
                </div>
            </div>

            <!-- Health Status Card -->
            <div class="card border-0 shadow-sm p-4 mb-5 slide-up" data-aos="fade-up" data-aos-delay="200">
                <div class="d-flex align-items-center mb-3">
                    <div class="rounded-circle bg-primary bg-opacity-10 p-3 me-3">
                        <i class="fas fa-heartbeat fa-2x text-primary pulse"></i>
                    </div>
                    <h3 class="mb-0 fs-4">Your Health Dashboard</h3>
                </div>

                <div class="row g-4 mt-2">
                    <div class="col-md-4">
                        <div class="health-info-card p-3">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-calendar-alt text-primary fs-4 me-3"></i>
                                <div>
                                    <h6 class="mb-1">Next Appointment</h6>
                                    <p class="mb-0 small">
                                        {% if appointments and appointments|length > 0 %} {{ appointments[0][2] }} with Dr. {{ appointments[0][0] }} {% else %} No upcoming appointments {% endif %}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="health-info-card p-3">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-clipboard-list text-primary fs-4 me-3"></i>
                                <div>
                                    <h6 class="mb-1">Medical Records</h6>
                                    <p class="mb-0 small">
                                        <span class="health-status good"></span> Up to date
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="health-info-card p-3">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-pills text-primary fs-4 me-3"></i>
                                <div>
                                    <h6 class="mb-1">Prescriptions</h6>
                                    <p class="mb-0 small">
                                        <span class="health-status warning"></span> 1 renewal needed
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="row mt-5 pt-5 g-4" data-aos="fade-up" data-aos-delay="200">
                <div class="col-md-4 mb-4">
                    <div class="card h-100 float">
                        <div class="card-body py-4 px-4 text-center">
                            <div class="feature-icon">
                                <i class="fas fa-user-md"></i>
                            </div>
                            <h3 class="card-title fs-4 mb-3">Expert Doctors</h3>
                            <p class="card-text text-muted">Access to specialized healthcare professionals who provide personalized care.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card h-100 float" style="animation-delay: 0.5s">
                        <div class="card-body py-4 px-4 text-center">
                            <div class="feature-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <h3 class="card-title fs-4 mb-3">Easy Booking</h3>
                            <p class="card-text text-muted">Schedule appointments with just a few clicks for a seamless experience.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card h-100 float" style="animation-delay: 1s">
                        <div class="card-body py-4 px-4 text-center">
                            <div class="feature-icon">
                                <i class="fas fa-bell"></i>
                            </div>
                            <h3 class="card-title fs-4 mb-3">Reminders</h3>
                            <p class="card-text text-muted">Never miss an appointment with our smart notification system.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Profile Section -->
    <section id="profile" class="min-vh-100 d-flex align-items-center bg-light position-relative">
        <div class="bg-pattern"></div>
        <div class="container py-5">
            <h2 class="text-center text-primary fw-bold section-heading mb-5" data-aos="fade-up">Your Profile</h2>
            <div class="row justify-content-center">
                <div class="col-lg-8" data-aos="fade-up" data-aos-delay="200">
                    <div class="card border-0 shadow-lg rounded-lg overflow-hidden">
                        <div class="card-header bg-primary text-white p-4">
                            <div class="d-flex align-items-center">
                                <div class="rounded-circle bg-white p-3 me-3">
                                    <i class="fas fa-user fa-2x text-primary"></i>
                                </div>
                                <div>
                                    <h3 class="mb-0">{{ user_name }}</h3>
                                    <p class="mb-0 opacity-75"><i class="fas fa-envelope me-1"></i> {{ user_email }}</p>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            <form action="{{ url_for('update_profile_from_index') }}" method="POST" class="mt-4">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <div class="form-floating">
                                            <input type="text" id="full_name" name="full_name" class="form-control" placeholder="Enter your full name" value="{{ full_name }}">
                                            <label for="full_name"><i class="fas fa-user me-2"></i>Full Name</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="form-floating">
                                            <input type="text" id="phone" name="phone" class="form-control" placeholder="Enter your phone number" value="{{ phone_number }}">
                                            <label for="phone"><i class="fas fa-phone me-2"></i>Phone Number</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mt-4">
                                    <span class="text-muted small"><i class="fas fa-info-circle me-1"></i> Profile updates are saved automatically</span>
                                    <a href="{{ url_for('profile') }}" class="btn btn-primary">
                                        <i class="fas fa-cog me-1"></i> Advanced Settings
                                    </a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Doctors Section -->
    <section id="doctors" class="min-vh-100 py-5 position-relative">
        <div class="bg-pattern"></div>
        <div class="container">
            <div class="text-center mb-5" data-aos="fade-up">
                <h2 class="section-heading">Our Specialists</h2>
                <p class="text-muted lead">Connect with our expert specialists for personalized care</p>
            </div>

            <!-- Specialty Filter Buttons -->
            <div class="specialty-filter mb-5 text-center" data-aos="fade-up" data-aos-delay="100">
                <div class="d-flex flex-wrap justify-content-center gap-2">
                    <button class="btn btn-sm btn-outline-primary active px-3 rounded-pill" onclick="filterSpecialty('all')">
                        All Specialties
                    </button> {% set specialties = [] %} {% for doctor in doctors %} {% if doctor[1] not in specialties %} {% set specialties = specialties + [doctor[1]] %}
                    <button class="btn btn-sm btn-outline-primary px-3 rounded-pill" onclick="filterSpecialty('{{ doctor[1] }}')">
                                {{ doctor[1] }}
                            </button> {% endif %} {% endfor %}
                </div>
            </div>

            <div class="row g-4">
                {% if doctors %} {% for doctor in doctors %}
                <div class="col-md-6 col-lg-4 mb-4 doctor-card" data-specialty="{{ doctor[1] }}" data-aos="fade-up" data-aos-delay="{{ loop.index * 100 }}">
                    <div class="card h-100 border-0 shadow-sm hover-card">
                        <div class="position-relative">
                            <img src="https://via.placeholder.com/300x200/f8f9fa/0d6efd?text=Dr.+{{ doctor[0] }}" class="card-img-top" alt="{{ doctor[0] }}" style="height: 200px; object-fit: cover;">
                            <div class="position-absolute bottom-0 start-0 bg-primary text-white py-1 px-3">
                                <i class="fas fa-stethoscope me-2"></i>{{ doctor[1] }}
                            </div>
                        </div>
                        <div class="card-body text-center">
                            <h5 class="card-title mb-1">Dr. {{ doctor[0] }}</h5>
                            <div class="mb-3">
                                <span class="text-warning">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star-half-alt"></i>
                                </span>
                                <small class="text-muted">(4.5/5)</small>
                            </div>
                            <div class="doctor-info mb-3">
                                <div class="d-flex justify-content-between text-muted mb-2">
                                    <span><i class="fas fa-calendar-check me-2"></i>Available</span>
                                    <span>Mon-Fri</span>
                                </div>
                                <div class="d-flex justify-content-between text-muted">
                                    <span><i class="fas fa-clock me-2"></i>Hours</span>
                                    <span>9 AM - 5 PM</span>
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#appointmentModal" data-doctor="{{ doctor[0] }}" data-specialty="{{ doctor[1] }}">
                                <i class="fas fa-calendar-plus me-2"></i>Book Appointment
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %} {% else %}
                <div class="col-12 text-center py-5">
                    <div class="alert alert-info" role="alert">
                        <i class="fas fa-info-circle me-2"></i> No doctors available at the moment.
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </section>

    <!-- Appointment Booking Modal -->
    <div class="modal fade" id="appointmentModal" tabindex="-1" aria-labelledby="appointmentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content border-0 shadow">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="appointmentModalLabel">
                        <i class="fas fa-calendar-plus me-2"></i>Book an Appointment
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="row">
                        <div class="col-md-6 mb-4 mb-md-0">
                            <div class="p-4 bg-light rounded-3 h-100">
                                <h5 class="fw-bold mb-3">Appointment Details</h5>
                                <div class="d-flex align-items-center mb-3">
                                    <div class="rounded-circle bg-primary bg-opacity-10 p-2 me-3">
                                        <i class="fas fa-user-md text-primary"></i>
                                    </div>
                                    <div>
                                        <p class="mb-0 text-muted small">Doctor</p>
                                        <p class="mb-0 fw-bold" id="modal-doctor-name"></p>
                                    </div>
                                </div>
                                <div class="d-flex align-items-center">
                                    <div class="rounded-circle bg-primary bg-opacity-10 p-2 me-3">
                                        <i class="fas fa-stethoscope text-primary"></i>
                                    </div>
                                    <div>
                                        <p class="mb-0 text-muted small">Specialty</p>
                                        <p class="mb-0 fw-bold" id="modal-specialty"></p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <form id="appointmentForm">
                                <div class="mb-3">
                                    <label for="appointment-date" class="form-label">
                                        <i class="fas fa-calendar-alt me-2"></i>Select Date
                                    </label>
                                    <input type="text" id="appointment-date" class="form-control flatpickr" placeholder="Choose appointment date">
                                </div>
                                <div class="mb-3">
                                    <label for="appointment-time" class="form-label">
                                        <i class="fas fa-clock me-2"></i>Select Time
                                    </label>
                                    <select id="appointment-time" class="form-select">
                                        <option value="">Select a time slot</option>
                                        <option value="09:00 AM">09:00 AM</option>
                                        <option value="10:00 AM">10:00 AM</option>
                                        <option value="11:00 AM">11:00 AM</option>
                                        <option value="12:00 PM">12:00 PM</option>
                                        <option value="01:00 PM">01:00 PM</option>
                                        <option value="02:00 PM">02:00 PM</option>
                                        <option value="03:00 PM">03:00 PM</option>
                                        <option value="04:00 PM">04:00 PM</option>
                                        <option value="05:00 PM">05:00 PM</option>
                                    </select>
                                </div>
                                <div class="form-floating mb-3">
                                    <textarea class="form-control" placeholder="Additional notes" id="appointment-notes" style="height: 100px"></textarea>
                                    <label for="appointment-notes">Additional Notes (optional)</label>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Cancel
                    </button>
                    <button type="button" class="btn btn-primary" id="save-appointment">
                        <i class="fas fa-check me-2"></i>Confirm Appointment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Appointments Section -->
    <section id="appointments" class="min-vh-100 bg-light position-relative">
        <div class="bg-pattern"></div>
        <div class="container py-5">
            <h2 class="text-center text-primary fw-bold section-heading mb-5" data-aos="fade-up">Your Appointments</h2>

            {% if appointments %}
            <div class="row">
                {% for appointment in appointments %}
                <div class="col-lg-4 col-md-6 mb-4" data-aos="fade-up" data-aos-delay="{{ loop.index * 100 }}">
                    <div class="card border-0 shadow-sm appointment-card">
                        <div class="card-header bg-white border-0 pt-4 pb-0">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="fw-bold text-primary mb-0">Dr. {{ appointment[0] }}</h5>
                                <span class="badge bg-primary rounded-pill px-3 py-2">
                                    <i class="fas fa-calendar-check me-1"></i> Confirmed
                                </span>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            <div class="d-flex mb-3">
                                <div class="rounded-circle bg-primary bg-opacity-10 p-2 me-3">
                                    <i class="fas fa-stethoscope text-primary"></i>
                                </div>
                                <div>
                                    <p class="mb-0 text-muted small">Specialty</p>
                                    <p class="mb-0 fw-bold">{{ appointment[1] }}</p>
                                </div>
                            </div>
                            <div class="d-flex mb-3">
                                <div class="rounded-circle bg-primary bg-opacity-10 p-2 me-3">
                                    <i class="fas fa-clock text-primary"></i>
                                </div>
                                <div>
                                    <p class="mb-0 text-muted small">Date & Time</p>
                                    <p class="mb-0 fw-bold">{{ appointment[2] }}</p>
                                </div>
                            </div>
                            <div class="d-flex justify-content-between mt-4">
                                <button class="btn btn-sm btn-outline-primary" onclick="rescheduleAppointment('{{ appointment[0] }}', '{{ appointment[2] }}')">
                                    <i class="fas fa-calendar-alt me-1"></i> Reschedule
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="cancelAppointment('{{ appointment[0] }}', '{{ appointment[2] }}')">
                                    <i class="fas fa-times-circle me-1"></i> Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="row justify-content-center" data-aos="fade-up">
                <div class="col-md-8 text-center">
                    <div class="card border-0 shadow-sm p-4">
                        <div class="py-5">
                            <i class="fas fa-calendar-times fa-5x text-primary opacity-50 mb-4"></i>
                            <h4 class="fw-bold">No Appointments Yet</h4>
                            <p class="text-muted mb-4">You don't have any scheduled appointments. Book an appointment with one of our specialists.</p>
                            <a href="#doctors" class="btn btn-primary">
                                <i class="fas fa-user-md me-2"></i>Find a Doctor
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </section>

    <!-- Suggestions Section -->
    <section id="suggestions" class="min-vh-100 bg-light position-relative">
        <div class="bg-pattern"></div>
        <div class="container py-5">
            <h2 class="text-center text-primary fw-bold section-heading mb-5" data-aos="fade-up">Your Feedback</h2>
            <div class="row justify-content-center" data-aos="fade-up" data-aos-delay="100">
                <div class="col-lg-8">
                    <div class="card border-0 shadow-lg">
                        <div class="card-body p-5">
                            <form action="/submit_suggestions" method="post">
                                <div class="mb-4">
                                    <h4 class="fw-bold mb-3"><i class="fas fa-comment-alt me-2"></i>Share Your Thoughts</h4>
                                    <p class="text-muted mb-4">We value your feedback. Please share your suggestions to help us improve our services.</p>
                                    
                                    <!-- Rating Stars -->
                                    <div class="mb-3">
                                        <label class="form-label">Rate your experience</label>
                                        <div class="rating">
                                            <div class="star-rating">
                                                <input type="radio" id="star5" name="rating" value="5" checked />
                                                <label for="star5" title="5 stars"><i class="fas fa-star"></i></label>
                                                
                                                <input type="radio" id="star4" name="rating" value="4" />
                                                <label for="star4" title="4 stars"><i class="fas fa-star"></i></label>
                                                
                                                <input type="radio" id="star3" name="rating" value="3" />
                                                <label for="star3" title="3 stars"><i class="fas fa-star"></i></label>
                                                
                                                <input type="radio" id="star2" name="rating" value="2" />
                                                <label for="star2" title="2 stars"><i class="fas fa-star"></i></label>
                                                
                                                <input type="radio" id="star1" name="rating" value="1" />
                                                <label for="star1" title="1 star"><i class="fas fa-star"></i></label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-floating mb-3">
                                        <textarea id="suggestions-textarea" class="form-control" name="suggestions" rows="5" style="height: 150px" placeholder="Enter your suggestions here..."></textarea>
                                        <label for="suggestions-textarea">Your suggestions</label>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <button type="submit" class="btn btn-primary px-5">
                                        <i class="fas fa-paper-plane me-2"></i>Submit Feedback
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-primary text-white text-center py-4">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6 text-md-start mb-3 mb-md-0">
                    <h5 class="mb-0"><i class="fas fa-heartbeat me-2"></i>Medify</h5>
                    <p class="mb-0 small">Your trusted healthcare companion</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0 small">&copy; 2024 Medify, All Rights Reserved</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <!-- AOS Animation Library -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <script>
        // Initialize AOS animations
        document.addEventListener('DOMContentLoaded', function() {
            AOS.init({
                duration: 800,
                easing: 'ease-in-out',
                once: true
            });

            // Activate navbar links based on scroll position
            activateNavbarLinks();

            // Initialize date picker
            initDatePicker();

            // Handle smooth scrolling for anchor links
            enableSmoothScrolling();

            // Add scroll animations for doctors
            addScrollAnimations();

            // Update notification count on page load
            updateNotificationCount();

            // Set up click handlers for mark read buttons
            const markReadButtons = document.querySelectorAll('.btn-mark-read');
            markReadButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation(); // Prevent dropdown from closing
                    const notificationItem = this.closest('.notification-item');
                    notificationItem.classList.remove('unread');
                    updateNotificationCount();
                });
            });

            // Custom dropdown behavior to keep it open when clicking inside
            const notificationsWrapper = document.querySelector('.notifications-wrapper');
            if (notificationsWrapper) {
                notificationsWrapper.addEventListener('click', function(e) {
                    if (e.target.closest('.btn-mark-read')) {
                        e.stopPropagation();
                    }
                });
            }
        });

        // Handle sticky navbar style change
        window.addEventListener('scroll', function() {
            activateNavbarLinks();

            // Add sticky navbar class
            const navbar = document.querySelector('.navbar');
            if (window.scrollY > 50) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        });

        // Function to filter doctors by specialty
        function filterSpecialty(specialty) {
            // Update active button styling
            const buttons = document.querySelectorAll('.specialty-filter button');
            buttons.forEach(button => {
                button.classList.remove('active');
                if ((specialty === 'all' && button.textContent.trim() === 'All Specialties') ||
                    button.textContent.trim() === specialty) {
                    button.classList.add('active');
                }
            });

            // Filter the doctor cards with enhanced animation
            const doctorCards = document.querySelectorAll('.doctor-card');
            doctorCards.forEach(card => {
                if (specialty === 'all' || card.getAttribute('data-specialty') === specialty) {
                    // Show with animation
                    card.style.opacity = '0';
                    card.style.transform = 'translateY(20px) scale(0.95)';
                    card.style.display = 'block';

                    setTimeout(() => {
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0) scale(1)';
                        card.style.transition = 'all 0.5s cubic-bezier(0.2, 0.8, 0.2, 1)';
                    }, 50);
                } else {
                    // Hide with animation
                    card.style.opacity = '0';
                    card.style.transform = 'translateY(20px) scale(0.95)';
                    card.style.transition = 'all 0.5s cubic-bezier(0.2, 0.8, 0.2, 1)';

                    setTimeout(() => {
                        card.style.display = 'none';
                    }, 500);
                }
            });

            // Refresh AOS animations
            setTimeout(() => {
                AOS.refresh();
            }, 600);
        }

        // Add scroll animations for doctor cards with staggered effect
        function addScrollAnimations() {
            const doctorCards = document.querySelectorAll('.doctor-card');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach((entry, index) => {
                    if (entry.isIntersecting) {
                        // Add staggered delay for each card
                        setTimeout(() => {
                            entry.target.classList.add('animated');
                            entry.target.style.opacity = '1';
                            entry.target.style.transform = 'translateY(0)';
                        }, index * 150);
                        observer.unobserve(entry.target);
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            });

            doctorCards.forEach((card, index) => {
                observer.observe(card);
                card.style.opacity = '0';
                card.style.transform = 'translateY(30px)';
                card.style.transition = 'all 0.6s cubic-bezier(0.2, 0.8, 0.2, 1)';
            });
        }

        function activateNavbarLinks() {
            const sections = document.querySelectorAll('section');
            const navLinks = document.querySelectorAll('.nav-link');

            let currentSection = '';
            const scrollPosition = window.scrollY + 100;

            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.offsetHeight;

                if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
                    currentSection = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + currentSection) {
                    link.classList.add('active');
                }
            });
        }

        function enableSmoothScrolling() {
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    e.preventDefault();

                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        window.scrollTo({
                            top: target.offsetTop - 70,
                            behavior: 'smooth'
                        });
                    }
                });
            });
        }

        function initDatePicker() {
            flatpickr(".flatpickr", {
                minDate: "today",
                dateFormat: "Y-m-d",
                disable: [
                    function(date) {
                        // Disable weekends
                        return (date.getDay() === 0 || date.getDay() === 6);
                    }
                ]
            });

            // Handle opening appointment modal
            const appointmentModal = document.getElementById('appointmentModal');
            if (appointmentModal) {
                appointmentModal.addEventListener('show.bs.modal', function(event) {
                    const button = event.relatedTarget;
                    const doctor = button.getAttribute('data-doctor');
                    const specialty = button.getAttribute('data-specialty');

                    // Set modal content
                    document.getElementById('modal-doctor-name').textContent = doctor;
                    document.getElementById('modal-specialty').textContent = specialty;
                });
            }

            // Handle booking appointment
            const saveButton = document.getElementById('save-appointment');
            if (saveButton) {
                saveButton.addEventListener('click', function() {
                    const doctor = document.getElementById('modal-doctor-name').textContent;
                    const specialty = document.getElementById('modal-specialty').textContent;
                    const date = document.getElementById('appointment-date').value;
                    const time = document.getElementById('appointment-time').value;
                    const notes = document.getElementById('appointment-notes').value || '';

                    // Validate date and time
                    if (!date || !time) {
                        // Prevent submission if date or time is missing
                        e.preventDefault();
                        // Show error toast notification
                        showToast('warning', 'Missing Information', 'Please select both date and time for your appointment.');
                        return false;
                    }

                    const timeSlot = `${date} at ${time}`;

                    // Send appointment data to server
                    fetch('/book_appointment', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                doctor: doctor,
                                specialty: specialty,
                                time: timeSlot,
                                notes: notes
                            })
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.status === 'success') {
                                // Success toast
                                showToast('success', 'Success', data.message);
                                // Clear the form
                                document.getElementById('appointment-form').reset();
                                // Close modal
                                const modal = bootstrap.Modal.getInstance(appointmentModal);
                                modal.hide();
                                // Refresh page to show new appointment
                                setTimeout(() => { window.location.reload() }, 1500);
                            } else {
                                // Error toast
                                showToast('error', 'Error', data.message);
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            showToast('error', 'Error', 'There was an error booking the appointment.');
                        });
                });
            }
        }

        // Function to cancel an appointment
        function cancelAppointment(doctor, time) {
            if (confirm('Are you sure you want to cancel this appointment?')) {
                fetch('/cancel_appointment', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            doctor: doctor,
                            time: time
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            showToast('success', 'Cancelled', data.message);
                            // Refresh page to update appointment list
                            setTimeout(() => { window.location.reload() }, 1500);
                        } else {
                            showToast('error', 'Error', data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showToast('error', 'Error', 'There was an error cancelling the appointment.');
                    });
            }
        }

        // Function to reschedule an appointment
        function rescheduleAppointment(doctor, time) {
            // Open the modal and pre-fill with doctor info
            const appointmentModal = new bootstrap.Modal(document.getElementById('appointmentModal'));
            document.getElementById('modal-doctor-name').textContent = doctor;

            // Get specialty from the appointment card
            const doctorCards = document.querySelectorAll('.doctor-card');
            let specialty = '';
            doctorCards.forEach(card => {
                if (card.querySelector('h5').textContent.includes(doctor)) {
                    specialty = card.getAttribute('data-specialty');
                }
            });

            document.getElementById('modal-specialty').textContent = specialty;

            // Cancel the existing appointment first
            cancelAppointment(doctor, time);

            // Show the modal for rebooking
            appointmentModal.show();
        }

        // Function to clear all notifications
        function clearAllNotifications() {
            const unreadNotifications = document.querySelectorAll('.notification-item.unread');
            unreadNotifications.forEach(item => {
                item.classList.remove('unread');
            });
            updateNotificationCount();
        }

        // Function to update the notification count display
        function updateNotificationCount() {
            const unreadCount = document.querySelectorAll('.notification-item.unread').length;

            // Update badge in dropdown header
            const headerBadge = document.querySelector('.dropdown-header .badge');
            if (headerBadge) {
                headerBadge.textContent = unreadCount;
                if (unreadCount === 0) {
                    headerBadge.classList.add('d-none');
                } else {
                    headerBadge.classList.remove('d-none');
                }
            }

            // Update the notification badge in navbar
            const navbarBadge = document.querySelector('.notification-badge');
            if (navbarBadge) {
                if (unreadCount === 0) {
                    navbarBadge.style.display = 'none';
                } else {
                    navbarBadge.style.display = 'inline-block';
                    navbarBadge.textContent = unreadCount;
                }
            }
        }

        // Toast notification function
        function showToast(type, title, message) {
            const toastContainer = document.getElementById('toastContainer');
            if (!toastContainer) {
                const container = document.createElement('div');
                container.id = 'toastContainer';
                container.className = 'toast-container';
                document.body.appendChild(container);
            }
            
            const toastId = 'toast-' + Date.now();
            const toastEl = document.createElement('div');
            toastEl.className = 'toast';
            toastEl.id = toastId;
            
            let bgClass = 'bg-primary';
            let icon = '<i class="fas fa-info-circle"></i>';
            
            if (type === 'success') {
                bgClass = 'bg-success';
                icon = '<i class="fas fa-check-circle"></i>';
            } else if (type === 'error') {
                bgClass = 'bg-danger';
                icon = '<i class="fas fa-exclamation-circle"></i>';
            } else if (type === 'warning') {
                bgClass = 'bg-warning';
                icon = '<i class="fas fa-exclamation-triangle"></i>';
            }
            
            toastEl.innerHTML = `
                <div class="toast-header ${bgClass} text-white">
                    ${icon} <strong class="me-auto ms-2">${title}</strong>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                </div>
                <div class="toast-body">
                    ${message}
                </div>
            `;
            
            document.getElementById('toastContainer').appendChild(toastEl);
            const toast = new bootstrap.Toast(toastEl, { autohide: true, delay: 5000 });
            toast.show();
            
            toastEl.addEventListener('hidden.bs.toast', function() {
                this.remove();
            });
        }

        // Auto-save functionality for profile form
        document.addEventListener('DOMContentLoaded', function() {
            const phoneInput = document.getElementById('phone');
            const fullNameInput = document.getElementById('full_name');
            const profileForm = document.querySelector('#profile form');

            // Add event listeners for input change with debounce
            let saveTimeout;
            const debounceTime = 1000; // 1 second debounce

            if (phoneInput) {
                phoneInput.addEventListener('input', function() {
                    clearTimeout(saveTimeout);
                    saveTimeout = setTimeout(submitProfileForm, debounceTime);
                });
            }

            if (fullNameInput) {
                fullNameInput.addEventListener('input', function() {
                    clearTimeout(saveTimeout);
                    saveTimeout = setTimeout(submitProfileForm, debounceTime);
                });
            }

            function submitProfileForm() {
                // Get current form values
                const formData = new FormData(profileForm);

                // Submit the form data via fetch API
                fetch(profileForm.action, {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => {
                        if (response.ok) {
                            showToast('success', 'Profile Updated', 'Profile updated successfully');

                            // Update displayed values
                            const userName = document.querySelector('h3.mb-0');
                            if (userName && fullNameInput.value) {
                                userName.textContent = fullNameInput.value;
                            }
                        }
                    })
                    .catch(error => {
                        console.error('Error saving profile:', error);
                        showToast('error', 'Update Failed', 'Error updating profile');
                    });
            }
        });

        // Feedback form submission
        document.querySelector('form[action="/submit_suggestions"]').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const rating = document.querySelector('input[name="rating"]:checked').value;
            formData.append('rating', rating);
            
            // Get the suggestions value and add it as comment for submit_feedback endpoint
            const suggestions = formData.get('suggestions');
            formData.append('comment', suggestions);

            fetch('/submit_feedback', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success === true) {
                    showToast('success', 'Thank you!', data.message);
                    this.reset();
                } else {
                    showToast('error', 'Error', data.message);
                }
            })
            .catch(error => {
                showToast('error', 'Error', 'An error occurred while submitting your feedback.');
                console.error('Error:', error);
            });
        });
    </script>
</body>

</html>